<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>获取订单</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 500px;
    }

    .header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .header h1 {
      color: #333;
      margin-bottom: 0.5rem;
    }

    .header p {
      color: #666;
      font-size: 0.9rem;
    }

    .amount-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .btn {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: transform 0.2s;
      text-align: center;
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .btn-100 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .btn-200 {
      background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
    }

    .btn-500 {
      background: linear-gradient(135deg, #00c9ff 0%, #92fe9d 100%);
    }

    .alert {
      padding: 0.75rem;
      border-radius: 5px;
      margin-bottom: 1rem;
      display: none;
    }

    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .loading {
      display: none;
      text-align: center;
      margin-top: 1rem;
    }

    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #667eea;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>获取订单</h1>
    <p>请选择订单金额</p>
  </div>

  <div id="alert" class="alert"></div>

  <div class="amount-buttons">
    <button class="btn btn-100" onclick="pullOrder(100)">100 元</button>
    <button class="btn btn-200" onclick="pullOrder(200)">200 元</button>
    <button class="btn btn-500" onclick="pullOrder(500)">500 元</button>
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p>正在获取订单...</p>
  </div>
</div>

<script>
  // 显示提示信息
  function showAlert(message, type) {
    const alertDiv = document.getElementById('alert');
    alertDiv.textContent = message;
    alertDiv.className = 'alert alert-' + type;
    alertDiv.style.display = 'block';

    // 3秒后自动隐藏
    setTimeout(() => {
      alertDiv.style.display = 'none';
    }, 3000);
  }

  // 显示加载状态
  function showLoading() {
    document.getElementById('loading').style.display = 'block';
    // 禁用所有按钮
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(button => {
      button.disabled = true;
    });
  }

  // 隐藏加载状态
  function hideLoading() {
    document.getElementById('loading').style.display = 'none';
    // 启用所有按钮
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(button => {
      button.disabled = false;
    });
  }

  // 获取订单
  function pullOrder(amount) {
    showLoading();

    // 发送请求获取指定金额的订单
    fetch('/game/pull', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        amount: amount
      })
    })
            .then(response => response.json())
            .then(data => {
              hideLoading();

              if (data.code === 200) {
                // 成功获取订单URL，直接跳转
                if (data.data && data.data.url) {
                  window.location.href = data.data.url;
                } else {
                  showAlert('订单获取成功，但URL为空', 'error');
                }
              } else {
                showAlert(data.msg || '获取订单失败', 'error');
              }
            })
            .catch(error => {
              hideLoading();
              showAlert('网络错误，请稍后重试', 'error');
              console.error('Pull order error:', error);
            });
  }
</script>
</body>
</html>
